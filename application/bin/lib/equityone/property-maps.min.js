var net,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function c(){this.constructor=b}for(var d in a)__hasProp.call(a,d)&&(b[d]=a[d]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};net=this.net||{};net.equityone=this.net.equityone||{};net.equityone.maps=this.net.equityone.maps||{};net.equityone.maps.common=this.net.equityone.maps.common||{};
net.equityone.maps.controller=this.net.equityone.maps.controller||{};net.equityone.maps.event=this.net.equityone.maps.event||{};net.equityone.maps.model=this.net.equityone.maps.model||{};net.equityone.maps.view=this.net.equityone.maps.view||{};
net.equityone.maps.common.Utils=function(){function b(){}b.getQuery=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(location.search);return null==a?void 0:decodeURIComponent(a[1].replace(/\+/g," "))};b.request=function(a,c){var d;d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4===d.readyState)return 200!==d.status&&304!==d.status?c({error:!0}):c({data:d.responseText})};return d.send()};b.isSigma=function(){return-1<
location.host.indexOf("sigma.")};b.getPosition=function(a){var c,d;d=c=0;if(a.offsetParent){for(;c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;);return{x:c,y:d}}return null};return b}();
net.equityone.maps.event.EventDispatcher=function(){function b(a){this.listeners=null!=a?a:[];this.dispatchEvent=__bind(this.dispatchEvent,this);this.removeEventListener=__bind(this.removeEventListener,this);this.addEventListener=__bind(this.addEventListener,this)}b.prototype.addEventListener=function(a,c){return this.listeners.push({type:a,callback:c})};b.prototype.removeEventListener=function(a,c){var d,e,h,f,b;b=[];for(d=h=f=this.listeners.length-1;0>=f?0>h:0<h;d=0>=f?++h:--h)e=this.listeners[d],
e.type===a&&e.callback===c?b.push(this.listeners.splice(d,1)):b.push(void 0);return b};b.prototype.dispatchEvent=function(a,c){var d,e,h,f,b,g;null==c&&(c=null);d={target:this,type:a,data:c};b=this.listeners;g=[];h=0;for(f=b.length;h<f;h++)e=b[h],e.type===a?g.push(e.callback(d)):g.push(void 0);return g};return b}();net.equityone.maps.event.Event=function(){function b(){}b.READY="ready";b.SHOW_UNIT="showUnit";b.HIDE_UNIT="hideUnit";return b}();
net.equityone.maps.model.PropertyModel=function(b){function a(){this._getPropertyById=__bind(this._getPropertyById,this);this._handleLoad=__bind(this._handleLoad,this);this._loadForegroundImage=__bind(this._loadForegroundImage,this);this._loadBackgroundImage=__bind(this._loadBackgroundImage,this);this._getSizeData=__bind(this._getSizeData,this);this._combine=__bind(this._combine,this);this._getPropertyData=__bind(this._getPropertyData,this);this._getPositionData=__bind(this._getPositionData,this);
this.fetch=__bind(this.fetch,this);a.__super__.constructor.call(this);this.data.id=d.getQuery("ID");this.data.urls.background=""+e+"/assets/maps/"+this.data.id+"-background.png";this.data.urls.foreground=""+e+"/assets/maps/"+this.data.id+"-foreground.png"}var c,d,e;__extends(a,b);c=net.equityone.maps.event.Event;d=net.equityone.maps.common.Utils;e=d.isSigma()?"sitemaps":"site_maps";a.prototype.data={id:null,width:0,height:0,units:[],urls:{background:null,foreground:null}};a.prototype.positionData=
null;a.prototype.propertyData=null;a.prototype.loadCount=0;a.prototype.fetch=function(){this._getPositionData();this._getPropertyData();return this._getSizeData()};a.prototype._getPositionData=function(){return d.request(""+e+"/data/"+this.data.id+".json",function(a){return function(f){a.positionData=JSON.parse(f.data);a.propertyData&&a._combine();return a._handleLoad()}}(this))};a.prototype._getPropertyData=function(){var a,f,c;c=""+location.protocol+"//"+location.host;f="/siteplanbrowser/xmlgen.aspx?ID="+
this.data.id;a="/tools/xmlgen.aspx?ID="+this.data.id;c+=d.isSigma()?f:a;return d.request(c,function(a){return function(h){a.propertyData=document.createElement("div");a.propertyData.innerHTML=h.data;a.positionData&&a._combine();return a._handleLoad()}}(this))};a.prototype._combine=function(){var a,c,e,d,b,m,n;m=this.positionData;n=[];d=0;for(b=m.length;d<b;d++)c=m[d],a=c.id.toLowerCase(),(e=this._getPropertyById(a))&&n.push(this.data.units.push({id:a,shape:c.shape,coords:c.coords,occupant:e.occupant,
color:e.color,fields:e.fields}));return n};a.prototype._getSizeData=function(){this._loadBackgroundImage();return this._loadForegroundImage()};a.prototype._loadBackgroundImage=function(){var a;a=new Image;a.src=this.data.urls.background;return a.onload=function(c){return function(){c.data.width=a.width;c.data.height=a.height;return c._handleLoad()}}(this)};a.prototype._loadForegroundImage=function(){var a;a=new Image;a.src=this.data.urls.foreground;return a.onload=function(a){return function(){return a._handleLoad()}}(this)};
a.prototype._handleLoad=function(){if(4===++this.loadCount)return this.dispatchEvent(c.READY)};a.prototype._getPropertyById=function(a){var c,e,d,b,m;e=this.propertyData.getElementsByTagName("unit");b=0;for(m=e.length;b<m;b++)if(c=e[b],d={},d.id=c.getElementsByTagName("unitnumber")[0].textContent,"string"===typeof d.id&&(d.id=d.id.toLowerCase().replace(/\ /g,"_"),d.id===a)){d.occupant=c.getElementsByTagName("occupant")[0].textContent;d.color="#"+c.getElementsByTagName("color")[0].textContent;d.fields=
[];m=c.getElementsByTagName("item");c=0;for(b=m.length;c<b;c++)e=m[c],a=e.getAttribute("label"),e=e.getAttribute("val"),d.fields.push({label:a,value:e});return d}};return a}(net.equityone.maps.event.EventDispatcher);
net.equityone.maps.view.LoaderView=function(){function b(a){this.parent=a;this.hide=__bind(this.hide,this);this.node=document.createElement("div");this.node.className="layer loader";this.parent.appendChild(this.node)}b.prototype.hide=function(){return this.parent.removeChild(this.node)};return b}();
net.equityone.maps.view.BackgroundView=function(){function b(a){this.parent=a;this.render=__bind(this.render,this);this.node=document.createElement("div");this.node.className="layer background";this.parent.appendChild(this.node)}b.prototype.render=function(a){this.data=a;return this.node.style.backgroundImage="url("+this.data+")"};return b}();
net.equityone.maps.view.MidgroundView=function(){function b(a){this.parent=a;this._parseCoords=__bind(this._parseCoords,this);this._drawPoly=__bind(this._drawPoly,this);this._drawRect=__bind(this._drawRect,this);this.render=__bind(this.render,this);this.node=document.createElement("canvas");this.node.className="layer midground";this.ctx=this.node.getContext("2d");this.parent.appendChild(this.node)}b.prototype.render=function(a){var c,d,e,b,f;this.data=a;this.node.width=this.data.width;this.node.height=
this.data.height;b=this.data.units;f=[];d=0;for(e=b.length;d<e;d++)c=b[d],a="rect"===c.shape?this._drawRect:this._drawPoly,f.push(a(c));return f};b.prototype._drawRect=function(a){var c,d,e,b;if(null!=a.coords)return c=a.coords.split(","),e=c[0],b=c[1],d=c[2]-e,c=c[3]-b,this.ctx.fillStyle=a.color,this.ctx.fillRect(e,b,d,c)};b.prototype._drawPoly=function(a){var c,d,e;if(null!=a.coords){c=this._parseCoords(a.coords);this.ctx.fillStyle=a.color;this.ctx.beginPath();this.ctx.moveTo(c[0].x,c[0].y);d=0;
for(e=c.length;d<e;d++)a=c[d],this.ctx.lineTo(a.x,a.y);this.ctx.closePath();return this.ctx.fill()}};b.prototype._parseCoords=function(a){var c,d,e,b,f;d=[];a=a.split(",");c=b=0;for(f=a.length;b<f;c=b+=2)e=a[c],c=a[c+1],d.push({x:e,y:c});return d};return b}();
net.equityone.maps.view.ForegroundView=function(){function b(a){this.parent=a;this.render=__bind(this.render,this);this.node=document.createElement("div");this.node.className="layer foreground";this.parent.appendChild(this.node)}b.prototype.render=function(a){this.data=a;return this.node.style.backgroundImage="url("+this.data+")"};return b}();
net.equityone.maps.view.UnitsView=function(b){function a(c){this.parent=c;this._onBodyDown=__bind(this._onBodyDown,this);this._parseCoords=__bind(this._parseCoords,this);this._drawPoly=__bind(this._drawPoly,this);this._drawRect=__bind(this._drawRect,this);this._getUnit=__bind(this._getUnit,this);this._onMouseOut=__bind(this._onMouseOut,this);this._onMouse=__bind(this._onMouse,this);this.render=__bind(this.render,this);a.__super__.constructor.call(this);this.node=document.createElement("canvas");this.node.className=
"layer units";this.ctx=this.node.getContext("2d");this.parent.appendChild(this.node)}var c,d;__extends(a,b);d=net.equityone.maps.common.Utils;c=net.equityone.maps.event.Event;a.prototype.scaleX=1;a.prototype.scaleY=1;a.prototype.render=function(a){var c,b,d,g,k;this.data=a;this.node.onmousemove=this._onMouse;this.node.onmousedown=this._onMouse;this.node.onmouseout=this._onMouseOut;this.scaleX=this.parent.offsetWidth/this.data.width;this.scaleY=this.parent.offsetHeight/this.data.height;this.node.width=
this.data.width;this.node.height=this.data.height;document.body.onmousedown=this._onBodyDown;g=this.data.units;k=[];b=0;for(d=g.length;b<d;b++)c=g[b],c.uid=b+1,a="rect"===c.shape?this._drawRect:this._drawPoly,k.push(a(c));return k};a.prototype._onMouse=function(a){var b,f;f=d.getPosition(this.node);b=parseInt((a.pageX-f.x)/this.scaleX);f=parseInt((a.pageY-f.y)/this.scaleY);b=this.ctx.getImageData(b,f,1,1).data;return(b=this._getUnit(b[0]))?(b={id:b.id,x:a.pageX,y:a.pageY},this.dispatchEvent(c.SHOW_UNIT,
b)):this.dispatchEvent(c.HIDE_UNIT)};a.prototype._onMouseOut=function(){return this.dispatchEvent(c.HIDE_UNIT)};a.prototype._getUnit=function(a){var c,b,d,g;g=this.data.units;b=0;for(d=g.length;b<d;b++)if(c=g[b],c.uid===a)return c};a.prototype._drawRect=function(a){var c,b,d,g;if(a.coords)return c=a.coords.split(","),d=c[0],g=c[1],b=c[2]-d,c=c[3]-g,this.ctx.fillStyle="rgb("+a.uid+", 0, 0)",this.ctx.fillRect(d,g,b,c)};a.prototype._drawPoly=function(a){var c,b,d;if(a.coords){c=this._parseCoords(a.coords);
this.ctx.fillStyle="rgb("+a.uid+", 0, 0)";this.ctx.beginPath();this.ctx.moveTo(c[0].x,c[0].y);b=0;for(d=c.length;b<d;b++)a=c[b],this.ctx.lineTo(a.x,a.y);this.ctx.closePath();return this.ctx.fill()}};a.prototype._parseCoords=function(a){var c,b,d,g,k;b=[];a=a.split(",");c=g=0;for(k=a.length;g<k;c=g+=2)d=a[c],c=a[c+1],b.push({x:d,y:c});return b};a.prototype._onBodyDown=function(a){if((a.target||a.srcElement)!==this.node)return this.dispatchEvent(c.HIDE_UNIT)};return a}(net.equityone.maps.event.EventDispatcher);
net.equityone.maps.view.InfoView=function(){function b(c){this.units=c;this._hide=__bind(this._hide,this);this._getUnitData=__bind(this._getUnitData,this);this._position=__bind(this._position,this);this._populate=__bind(this._populate,this);this._show=__bind(this._show,this);this.node=document.createElement("div");this.mainNode=document.createElement("div");this.titleNode=document.createElement("div");this.contentNode=document.createElement("div");this.pointerNode=document.createElement("div");this.node.id=
"property-unit-info";this.mainNode.className="main";this.titleNode.className="title";this.contentNode.className="content";this.pointerNode.className="pointer";this.units.addEventListener(a.SHOW_UNIT,this._show);this.units.addEventListener(a.HIDE_UNIT,this._hide);document.body.appendChild(this.node);document.body.appendChild(this.pointerNode);this.node.appendChild(this.pointerNode);this.node.appendChild(this.mainNode);this.mainNode.appendChild(this.titleNode);this.mainNode.appendChild(this.contentNode)}
var a;a=net.equityone.maps.event.Event;b.prototype.data=null;b.prototype.id=null;b.prototype._show=function(a){var b,e;this.node.style.display="block";b=a.data.id;e=a.data.x;a=a.data.y;this.id!==b&&this._populate(b);this._position(e,a);return this.id=b};b.prototype._populate=function(a){var b,e,h,f,l;a=this._getUnitData(a);this.titleNode.innerHTML=a.occupant;this.contentNode.style.backgroundColor=a.color;this.contentNode.innerHTML="";f=a.fields;l=[];e=0;for(h=f.length;e<h;e++)a=f[e],b=document.createElement("div"),
b.innerHTML=""+a.label+": "+a.value,b.className="field",l.push(this.contentNode.appendChild(b));return l};b.prototype._position=function(a,b){var e,h,f,l,g,k;g=a-.5*this.node.offsetWidth;k=b-this.node.offsetHeight-this.pointerNode.offsetHeight-3;h="pointer";f=.5*this.node.offsetWidth-.5*this.pointerNode.offsetWidth;l=this.node.offsetHeight;e=document.body.offsetWidth;0>k&&(k=0+.5*this.node.offsetHeight,g<.5*document.body.offsetWidth?(g=a+25,f=-this.pointerNode.offsetHeight,h="pointer left"):(g=a-
this.node.offsetWidth-25,f=this.node.offsetWidth-4,h="pointer right"),l=b-this.node.offsetTop-.5*this.pointerNode.offsetHeight,2>l&&(l=2));0>g&&(g=0,f=a-this.node.offsetLeft-.5*this.pointerNode.offsetWidth,2>f&&(f=2));g>e&&(g=e,f=a-this.node.offsetLeft-.5*this.pointerNode.offsetWidth);this.pointerNode.className=h;this.pointerNode.style.left=""+f+"px";this.pointerNode.style.top=""+l+"px";this.node.style.left=""+g+"px";return this.node.style.top=""+k+"px"};b.prototype._getUnitData=function(a){var b,
e,h,f;f=this.data.units;e=0;for(h=f.length;e<h;e++)if(b=f[e],b.id===a)return b};b.prototype._hide=function(){return this.node.style.display="none"};return b}();
net.equityone.maps.view.PropertyView=function(){function b(){this._css=__bind(this._css,this);this.render=__bind(this.render,this);this.parent=document.getElementById("pnlSiteMapFlash");this.node=document.createElement("div");this.loader=new e(this.node);this.background=new a(this.node);this.midground=new h(this.node);this.foreground=new c(this.node);this.units=new f(this.node);this.info=new d(this.units);this.node.id="map-container";this.node.style.cssText=this._css();this.parent.appendChild(this.node)}
var a,c,d,e,h,f;d=net.equityone.maps.view.InfoView;f=net.equityone.maps.view.UnitsView;c=net.equityone.maps.view.ForegroundView;h=net.equityone.maps.view.MidgroundView;a=net.equityone.maps.view.BackgroundView;e=net.equityone.maps.view.LoaderView;b.prototype.render=function(a){this.data=a;this.info.data=this.data;this.loader.hide();this.background.render(this.data.urls.background);this.midground.render(this.data);this.foreground.render(this.data.urls.foreground);return this.units.render(this.data)};
b.prototype._css=function(){var a,b;b=this.parent.offsetWidth;a=Math.ceil(.66*b);return"position: absolute; width: "+b+"px; height: "+a+"px;"};return b}();
net.equityone.maps.controller.PropertyController=function(){function b(b,d){this.model=b;this.view=d;this._onModelReady=__bind(this._onModelReady,this);this.init=__bind(this.init,this);this.model.addEventListener(a.READY,this._onModelReady)}var a;a=net.equityone.maps.event.Event;b.prototype.init=function(){return this.model.fetch()};b.prototype._onModelReady=function(){return this.view.render(this.model.data)};return b}();
net.equityone.maps.PropertyMaps=function(){var b,a,c;b=net.equityone.maps.controller.PropertyController;c=net.equityone.maps.view.PropertyView;a=net.equityone.maps.model.PropertyModel;return function(){this.model=new a;this.view=new c;this.controller=new b(this.model,this.view);this.controller.init()}}();window.propertyMaps=new net.equityone.maps.PropertyMaps;
